<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Angry Birds ‚Äî Clone Cl√°ssico</title>
  <style>
    /* ‚îÄ‚îÄ RESET E BASE ‚îÄ‚îÄ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #1a1a2e;
      font-family: 'Arial Black', Arial, sans-serif;
      user-select: none;
      -webkit-user-select: none;
      touch-action: none;
    }

    /* ‚îÄ‚îÄ CONTAINER DO JOGO ‚îÄ‚îÄ */
    #gameContainer {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(ellipse at center, #1a1a2e 0%, #0d0d1a 100%);
    }

    /* ‚îÄ‚îÄ CANVAS ‚îÄ‚îÄ */
    #gameCanvas {
      position: absolute;
      cursor: crosshair;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      border: 3px solid rgba(255,255,255,0.1);
      border-radius: 4px;
      box-shadow: 0 0 40px rgba(0,0,0,0.8);
    }

    /* ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ */
    #loading {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #1a1a2e;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      color: #FFF;
      font-size: 28px;
      gap: 20px;
      transition: opacity 0.5s;
    }

    #loading .spinner {
      width: 60px; height: 60px;
      border: 6px solid rgba(255,255,255,0.2);
      border-top-color: #E53935;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    #loading .title {
      font-size: 42px;
      font-weight: 900;
      color: #E53935;
      text-shadow: 0 0 20px rgba(229,57,53,0.5);
      letter-spacing: 2px;
    }

    #loading .subtitle {
      font-size: 18px;
      color: rgba(255,255,255,0.6);
    }

    /* ‚îÄ‚îÄ TOOLTIP DE HABILIDADE ‚îÄ‚îÄ */
    #abilityTooltip {
      position: absolute;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.8);
      color: #FDD835;
      padding: 8px 18px;
      border-radius: 20px;
      font-size: 16px;
      font-weight: bold;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
      border: 2px solid #FDD835;
      white-space: nowrap;
      z-index: 100;
    }

    #abilityTooltip.show {
      opacity: 1;
    }

    /* ‚îÄ‚îÄ OVERLAY DE COMBO ‚îÄ‚îÄ */
    #comboOverlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      font-size: 64px;
      font-weight: 900;
      color: #FDD835;
      text-shadow: 0 0 30px rgba(253,216,53,0.8), 3px 3px 0 #E65100;
      pointer-events: none;
      transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.5s;
      z-index: 200;
    }

    #comboOverlay.show {
      transform: translate(-50%, -50%) scale(1);
    }

    /* ‚îÄ‚îÄ RESPONSIVO ‚îÄ‚îÄ */
    @media (max-width: 768px) {
      #gameCanvas {
        border: none;
        border-radius: 0;
      }
    }
  </style>
</head>
<body>

<!-- Loading Screen -->
<div id="loading">
  <div class="title">ANGRY BIRDS</div>
  <div class="spinner"></div>
  <div class="subtitle">Carregando o jogo...</div>
</div>

<!-- Game Container -->
<div id="gameContainer">
  <canvas id="gameCanvas" width="1280" height="640"></canvas>
  <div id="abilityTooltip">Clique para usar habilidade!</div>
  <div id="comboOverlay"></div>
</div>

<!-- Matter.js Physics Engine via CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>

<!-- Dados das fases -->
<script src="levels.js"></script>

<!-- Motor do jogo -->
<script src="game.js"></script>

<!-- Script de inicializa√ß√£o e extras -->
<script>
// ‚îÄ‚îÄ POLYFILL PARA roundRect ‚îÄ‚îÄ
if (!CanvasRenderingContext2D.prototype.roundRect) {
  CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
    if (w < 2*r) r = w/2;
    if (h < 2*r) r = h/2;
    this.beginPath();
    this.moveTo(x+r, y);
    this.arcTo(x+w, y,   x+w, y+h, r);
    this.arcTo(x+w, y+h, x,   y+h, r);
    this.arcTo(x,   y+h, x,   y,   r);
    this.arcTo(x,   y,   x+w, y,   r);
    this.closePath();
    return this;
  };
}

// ‚îÄ‚îÄ TOOLTIP DE HABILIDADE ‚îÄ‚îÄ
const abilityNames = {
  red:      'Red: Grito de Raiva (onda de choque)',
  blue:     'Blue: Dividir em 3 p√°ssaros!',
  chuck:    'Chuck: Turbo Acelera√ß√£o!',
  bomb:     'Bomb: EXPLOS√ÉO!',
  matilda:  'Matilda: Soltar Ovo Explosivo',
  hal:      'Hal: Bumerangue!',
  terence:  'Terence: For√ßa Bruta (sem habilidade)',
  bubbles:  'Bubbles: Inflar!'
};

let tooltipTimer = null;

function showAbilityTooltip(type) {
  const tooltip = document.getElementById('abilityTooltip');
  tooltip.textContent = abilityNames[type] || '';
  tooltip.classList.add('show');
  clearTimeout(tooltipTimer);
  tooltipTimer = setTimeout(() => tooltip.classList.remove('show'), 3000);
}

function showCombo(text) {
  const el = document.getElementById('comboOverlay');
  el.textContent = text;
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 800);
}

// ‚îÄ‚îÄ ESCONDER LOADING ‚îÄ‚îÄ
window.addEventListener('load', function() {
  setTimeout(function() {
    const loading = document.getElementById('loading');
    loading.style.opacity = '0';
    setTimeout(() => loading.style.display = 'none', 500);
  }, 800);
});

// ‚îÄ‚îÄ PREVENIR MENU DE CONTEXTO ‚îÄ‚îÄ
document.addEventListener('contextmenu', e => e.preventDefault());

// ‚îÄ‚îÄ TECLAS DE ATALHO ‚îÄ‚îÄ
document.addEventListener('keydown', function(e) {
  switch(e.key) {
    case ' ':
    case 'Enter':
      if (typeof activateAbility === 'function') activateAbility();
      break;
    case 'Escape':
      if (typeof gameState !== 'undefined') {
        if (gameState === 'playing') gameState = 'paused';
        else if (gameState === 'paused') gameState = 'playing';
      }
      break;
    case 'r':
    case 'R':
      if (typeof gameState !== 'undefined' && gameState === 'playing') {
        if (typeof loadLevel === 'function') loadLevel(currentEpisode, currentLevelIndex);
      }
      break;
    case 'm':
    case 'M':
      if (typeof gameState !== 'undefined') gameState = 'menu';
      break;
  }
});

// ‚îÄ‚îÄ MOSTRAR TOOLTIP QUANDO P√ÅSSARO √â LAN√áADO ‚îÄ‚îÄ
(function patchLaunch() {
  const origHandlePointerUp = window.handlePointerUp;
  // Ser√° sobrescrito ap√≥s carregamento do game.js
})();

// Monitora mudan√ßa de p√°ssaro para mostrar tooltip
let lastBirdType = null;
setInterval(function() {
  if (typeof activeBird !== 'undefined' && activeBird && typeof launched !== 'undefined' && launched) {
    if (activeBird.type !== lastBirdType) {
      lastBirdType = activeBird.type;
    }
    if (!activeBird.abilityUsed && activeBird.props && activeBird.props.ability !== 'none') {
      // Tooltip j√° mostrado no lan√ßamento
    }
  }
}, 500);

// Mostra tooltip ao lan√ßar
document.getElementById('gameCanvas').addEventListener('mouseup', function() {
  setTimeout(function() {
    if (typeof activeBird !== 'undefined' && activeBird &&
        typeof launched !== 'undefined' && launched &&
        !activeBird.abilityUsed) {
      showAbilityTooltip(activeBird.type);
    }
  }, 300);
});

document.getElementById('gameCanvas').addEventListener('touchend', function() {
  setTimeout(function() {
    if (typeof activeBird !== 'undefined' && activeBird &&
        typeof launched !== 'undefined' && launched &&
        !activeBird.abilityUsed) {
      showAbilityTooltip(activeBird.type);
    }
  }, 300);
});

// ‚îÄ‚îÄ FULLSCREEN ‚îÄ‚îÄ
function toggleFullscreen() {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().catch(() => {});
  } else {
    document.exitFullscreen();
  }
}

// Duplo clique para fullscreen
document.getElementById('gameCanvas').addEventListener('dblclick', toggleFullscreen);

// ‚îÄ‚îÄ INFORMA√á√ïES DE CONTROLE ‚îÄ‚îÄ
console.log('%cüê¶ Angry Birds Clone', 'font-size:20px;color:#E53935;font-weight:bold');
console.log('%cControles:', 'font-size:14px;color:#FDD835;font-weight:bold');
console.log('  üñ±Ô∏è  Arraste o p√°ssaro para atirar');
console.log('  üñ±Ô∏è  Clique durante o voo para usar habilidade');
console.log('  ‚å®Ô∏è  ESPA√áO/ENTER: usar habilidade');
console.log('  ‚å®Ô∏è  ESC: pausar/continuar');
console.log('  ‚å®Ô∏è  R: reiniciar fase');
console.log('  ‚å®Ô∏è  M: menu principal');
console.log('  üì± Toque e arraste no mobile');
</script>

</body>
</html>
